<!DOCTYPE html>
<script
  type="text/javascript"
  src="http://cdnjs.cloudflare.com/ajax/libs/gsap/latest/utils/Draggable.min.js"
></script>

<html>
  <head> </head>
  <body>
    <h1>Weekly Meal Planner</h1>
    <div class="container recipe-inputs">
      <div class="row">
        <input class="recipe1" type="text" placeholder="Recipe 1" />
      </div>
      <div class="row">
        <input class="recipe2" type="text" placeholder="Recipe 2" />
      </div>
      <div class="row">
        <input class="recipe3" type="text" placeholder="Recipe 3" />
      </div>
      <div class="row">
        <input class="recipe4" type="text" placeholder="Recipe 4" />
      </div>
      <div class="row">
        <input class="recipe5" type="text" placeholder="Recipe 5" />
      </div>
      <button type="submit" onClick="submitMeals()">Submit Recipes</button>
      <!-- <button type="submit" onClick="moveElement()">Move Element</button> -->
    </div>

    <div class="container"><ul id="shoppingList"></ul></div>
    <div class="container"><div id="allRecipes"></div></div>
    <div class="container" id="week-table">
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Breakfast</th>
            <th>Lunch</th>
            <th>Dinner</th>
            <th>Snack</th>
            <th>Total Protein</th>
            <th>Total Carbs</th>
            <th>Total Fat</th>
            <th>Total Cals</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Monday</td>
            <td
              class="monday breakfast"
              id="mon-brk"
              ondragover="onDragOver(event)"
              ondrop="onDrop(event)"
            ></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Tuesday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Wednesday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Thursday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Friday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Saturday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr>
            <td>Sunday</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>

    <script>
      // function moveElement(){
      //   const destination = document.getElementById('mon-brk');
      //   const source = document.getElementById('testId');
      //   destination.appendChild(source);
      // }

      function newEl(type, attrs = {}) {
        const el = document.createElement(type);
        for (let attr in attrs) {
          const value = attrs[attr];
          if (attr == "innerText") {
            el.innerText = value;
            el.id = Math.random();
            el.setAttribute("draggable", "true");
            el.setAttribute("ondragstart", "onDragStart(event)");
          } else el.setAttribute(attr, value);
        }
        return el;
      }

      function onDragStart(event) {
        event.dataTransfer.setData("text/plain", event.target.id);
        event.currentTarget.style.backgroundColor = "yellow";
      }

      function onDragOver(event) {
        event.preventDefault();
      }

      function onDrop(event) {
        event.currentTarget.style.backgroundColor = "white";
        const id = event.dataTransfer.getData("text");
        const draggableElement = document.getElementById(id);
        const dropzone = event.target;
        dropzone.appendChild(draggableElement);
        event.dataTransfer.clearData();
      }

      // Display shopping list in UI
      function showShoppingList(ingredients) {
        const shopListUl = document.getElementById("shoppingList");

        ingredients.forEach((ing) => {
          const ingredientLi = document.createElement("li");
          ing.unit == undefined
            ? (ingredientLi.innerText = ing.value + " " + ing.key)
            : (ingredientLi.innerText =
                ing.value + " " + ing.unit + " " + ing.key);
          shopListUl.append(ingredientLi);
        });
      }

      function showAllOptions(recipes) {
        const allRecipes = document.getElementById("allRecipes");

        recipes.forEach((recipe) => {
          console.log(recipe);
          for (let i = 0; i < recipe.servings; i++) {
            console.log(recipe.recipeName);
            const card = newEl("div", { class: "card" });
            const title = newEl("h4", { innerText: recipe.recipeName });
            card.appendChild(title);
            allRecipes.appendChild(card);
          }
        });
      }

      async function submitMeals() {
        let urls = [];
        const url1 = { url: document.querySelector(".recipe1").value };
        const url2 = { url: document.querySelector(".recipe2").value };
        const url3 = { url: document.querySelector(".recipe3").value };
        const url4 = { url: document.querySelector(".recipe4").value };
        const url5 = { url: document.querySelector(".recipe5").value };

        urls.push(url1, url2, url3, url4, url5);

        // Get scraped recipe data from recipe using server api
        jsonS = fetch("http://localhost:3000/recipe", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ urls }),
        })
          .then((response) => response.json())
          .then((response) => {
            showAllOptions(response.recipes);
            showShoppingList(response.ingredients);
          });
      }
    </script>
    <style></style>
  </body>
</html>
